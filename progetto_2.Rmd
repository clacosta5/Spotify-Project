---
title: "Progetto Fondamenti"
date: "`r Sys.Date()`"
css: stileProgetto.css
output:
  rmdformats::readthedown:
    highlight: kate
---


```{r setup, include=FALSE}
library(knitr)
library(rmdformats)

## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```


# PRIMA LE COSE RICAVATE DAI DATI DI ASCOLTO RICHIESTI DI SPOTIFY

# POI SUI BRANI SALVATI

# ALLA FINE COSE USANDO SPOTIFYR

mi raccomanto, solo 10 minuti per la presentazione, massimo 12

PER FONDAMENTI RICAVARE DA TUTTI I BRANI SALVATI IN LIBRERIA IL GENERE E DA LI FARCI UN GRAFICOOO!!!!!!
> impossibile

che genere ascolto di più > circa fatto

in che periodo (esempio inizio lockdown cosa ascoltavo) > si

in che giorni ascolto di piu e in che ora > si

cio che ascolto io vs cio che ascoltano gli altri in italia/mondo

canzoni piu ascoltate in questo anno/ultimi mesi > DA METTERE?

quante volte ho ascoltato una determinata canzone!!!
il numero di volte > si

# Introduzione

## Cosa è Spotify?

parlare di Spotify?

le mie domande?


```{r logo, echo=FALSE, fig.cap="Spotify Logo", out.width = "50%"}
knitr::include_graphics("img/spotifyLogo.png")
```


Spotify è un servizio musicale digitale (gratis o a pagamento) con il quale è semplice trovare la musica o il podcast giusto per ogni momento, su telefono, computer, tablet e altro ancora.

Ci sono milioni di brani ed episodi su Spotify.
Quindi, non importa cosa si stia facendo: quando si guida, ci si allena, si fa festa o ci si riposa, la musica e i podcast giusti sono sempre a portata di mano.

Si possono sfogliare le raccolte di amici, artisti e celebrità o creare delle tue playlist personali per ogni mood.

## Spotify Audio Analysis

Ogni brano ha delle particolari caratteristiche che lo rendono unico:

-   danceability: descrive quanto una canzone è adatta per ballare

-   energy: rappresenta una misura percettiva di intensità e attività (le tracce energiche sono veloci e rumorose)

-   valence: descrive la positività musicale trasmessa da un brano (alta valenza = più positive, bassa valenza = più negative)


```{r caricamento librerie, include=FALSE}
#caricamento librerie
library(jsonlite)
library(lubridate)
library(gghighlight)
library(spotifyr)
library(tidyverse)
library(ggplot2)
library(plotly)
library(dplyr)
library(kableExtra)
library(formattable)
library(genius)
# carico get spotify authorization
# ESTABLISH CONNECTION SPOTIFY API
id = "00f22c2d4c35499bb29854c73ffdff97"
id_secret = "46d59a3db5514cdd93c1de05365e57c8"
#idVale = "bebf67dce2c54886b1171591e84eeb4b"
#id_secretVale = "f7bdc08240ca4cacbe576181d472c2f8"
Sys.setenv(SPOTIFY_CLIENT_ID = id)
Sys.setenv(SPOTIFY_CLIENT_SECRET = id_secret)
get_spotify_authorization_code()

access_token <- get_spotify_access_token()
```



```{r lettura dataset e cambio nel giusto orario}
#lettura dataset

#GUIDE
#https://towardsdatascience.com/explore-your-activity-on-spotify-with-r-and-spotifyr-how-to-analyze-and-visualize-your-stream-dee41cb63526
#https://rpubs.com/womeimingzi11/how_my_spotify_looks_like


streamHistory <- fromJSON("spotify_data/StreamingHistoryTotal.json", flatten = TRUE)
myLibrary <- fromJSON("spotify_data/secondRequest/YourLibrary.json", flatten = TRUE)
savedTracks <- myLibrary$tracks

# cambiare ora!!! perchè orario di greenwitch
#tz = a character string that specifies which time zone to parse the date with. The string must be a time zone that is #recognized by the user's OS.
a <- ymd_hm(streamHistory$endTime, tz = "Etc/GMT+0")
#cambio l'orario con quello del fuso di Roma
streamHistory2 <- streamHistory %>%
  mutate(endTime = with_tz(a, "Europe/Rome"))
```



# Attività di ascolto per settimane e ore

In quali date ho ascoltato più o meno musica su Spotify?

Questa è la prima domanda che mi è venuta in mente.
Partendo dalle variabili si possono definire le ore, i minuti e i secondi, e sostanzialmente qualsiasi temporalità.
Ho creato così un primo grafico per osservare il comportamento della mia attività su Spotify durante tutto l'anno, ad esempio a settimana.

```{r ascolto per date}
# ADDING DATE AND TIMING
# prova con i secondi
mySpotify = streamHistory2 %>% 
  as_tibble() %>% #as_tibble() turns an existing object, such as a data frame or matrix, into a so-called tibble
  mutate_at("endTime", ymd_hms) %>%  #aggiungo i secondi, cambio solo la colonna che si chiama "endTIme"
  mutate(date = floor_date(endTime, "day") %>% as_date, seconds = msPlayed / 1000, minutes = seconds / 60) %>%
  mutate(artistName = str_replace(artistName, "Sasha Sloan", "Sasha Alex Sloan"))
# date -> prendo la data e basta senza orario, ricavo secondi e minuti suonati
# floor_date prende un oggetto data-ora e lo arrotonda per difetto al valore intero più vicino dell'unità di tempo        specificata, nel mio caso per giorno


oreStreaming = mySpotify %>% 
  filter(date >= "2020-01-01") %>% 
  group_by(date) %>% 
  group_by(date = floor_date(date, "week")) %>%  # raggruppo per settimane
  summarize(ore = sum(minutes) / 60) %>%         # sommo i minuti di ogni settimana / 60 = ore
  #verb summarise() riduce più valori fino a un singolo riassunto
  arrange(date) %>%                              # metto in ordine di data crescente
  ggplot(aes(x = date, y = ore)) + 
  geom_col(aes(fill = ore)) +
  scale_fill_gradient(low = "blue", high = "red") + 
  labs(x= "data", y= "ore di ascolto") + 
  ggtitle("In che date ho ascoltato più o meno musica su Spotify?", "Attività di ascolto per settimana da aprile 2020 a luglio 2021")

ggplotly(oreStreaming)
```

Si può notare come nelle settimane di quarantena e durante la sessione invernale (aprile/maggio 2020 - novembre/febbraio 2021) la mia attività di ascolto sia stata maggiore.
Questo perchè essendo a casa la mia voglia di ascoltare musica aumenta! E trovo rilassante ascoltare musica durante lo studio.


# Attività di ascolto per specifici artisti

In quali date ho ascoltato più o meno musica di un artista in particolare?

Un'altra domanda a cui posso rispondere in modo molto semplice e visualizzare con un grafico a linee, ho evidenziato i risultati che stai cercando utilizzando la funzione "gghighlight" e tramite la variabile artistName.

```{r ascolto artisti}
oreArtista <- mySpotify %>% 
  group_by(artistName, date = floor_date(date, "month")) %>%  # raggruppo per ascolto mensile
  summarize(hours = sum(minutes) / 60) %>%                    # sommo i minuti di ogni settimana / 60 = ore
  ggplot(aes(x = date, y = hours, group = artistName)) +
  geom_line(aes(color = artistName)) +
  geom_point(aes(color = artistName)) +
  labs(x= "date", y= "ore di ascolto") + 
  ggtitle("In che mese ho ascoltato più o meno musica di uno specifico artista?" ,"prendo in considerazione: Taylor Swift, Lana Del Rey, Chase Atlantic, Lorde e blink-182") +
  gghighlight(artistName == "Taylor Swift" || artistName == "Lana Del Rey" || artistName == "Chase Atlantic" || artistName == "Lorde" || artistName == "blink-182" || artistName == "Avril Lavigne" || artistName == "Sasha Alex Sloan")

ggplotly(oreArtista)

```

Nel mio caso c'è stato un picco di ascolto di Lana Del Rey durante la prima quarantena (aprile 2020) e di Taylor Swift a dicembre 2020/gennaio 2021, appena dopo l'uscita del suo ultimo album.


## Artisti più ascoltati (oltre 10 ore)

Quali sono stati gli artisti che ho ascoltato di più sul mio Spotify?

Ho impostato un minimo di ore di riproduzione e per scoprire quali artisti ho ascoltato di più.
Ad esempio, con più di 10 ore di ascolto.

```{r ascolto ore}
orePiuAscoltate <- mySpotify %>% 
  filter(date >= "2020-01-01") %>% 
  group_by(artistName) %>% 
  summarize(minutiAscoltati = sum(minutes), oreAscoltate = minutiAscoltati/60) %>% 
  filter(minutiAscoltati >= 600) %>%
  ggplot(aes(x = artistName, y = oreAscoltate)) + 
  geom_col(aes(fill = oreAscoltate, text = oreAscoltate)) +
  scale_fill_gradient(low = "blue", high = "red") + 
  labs(x= "artista", y= "ore di ascolto") + 
  ggtitle("Quali sono i miei artisti più ascoltati? (> 10 ore di ascolto)") +
  theme(axis.text.x = element_text(angle = 90))
ggplotly(orePiuAscoltate)
```

Anche in questo caso si può notare il picco di ascolto di Lana Del Rey e Taylor Swift; non a caso sono le mie cantanti preferite!


# Attività di ascolto per data e ora del giorno

In che momento ho avuto la maggior parte dell'attività di riproduzione?

Posso visualizzare per ora del giorno inclusa, il registro delle attività della mia cronologia completa con una mappa di calore, per osservare se questa abitudine è cambiata nel tempo.

```{r ascolto date e giorni}
timeDay <- mySpotify %>% 
  filter(date >= "2020-01-01") %>% 
  group_by(date, hour = hour(endTime)) %>%                  # raggruppo per data e ora
  summarize(minutiAscoltati = sum(minutes)) %>%             # minuti ascoltati
  ggplot(aes(x = hour, y = date, fill = minutiAscoltati)) + 
  geom_tile() + 
  labs(x= "Ora del giorno", y= "Data") + 
  ggtitle("Quando c'è stata più attività di riproduzione sul mio Spotify?", "Attività per data e ora del giorno") +
  scale_fill_gradient(low = "green", high = "blue")
timeDay
```

Come ben immaginavo, la mia attività di ascolto si concentra di più nel pomeriggio e durante la sera/prime ore della notte.
Anche durante la mattina ascolto musica (di meno), ad esempio nel tragitto casa-università.
E' stata inoltre abbastanza simile anche durante l'estate, anche se più bassa.


## Attività di ascolto per orario della giornata

Ho anche creato un grafico a barre per dare un'occhiata più da vicino in dettaglio alle ore del giorno in cui c'è più ascolto.

```{r ascolto nelle ore giorno}

hoursDay <- mySpotify %>% 
  filter(date >= "2020-01-01") %>% 
  group_by(date, hour = hour(endTime), weekday = wday(date, label = TRUE))%>% #wday visual weekday as a string
  summarize(minutesListened = sum(minutes))
  hoursDay %>% 
  ggplot(aes(x = hour, y = minutesListened, group = date)) +
  geom_col(fill = "#66b2ff") +
  labs(x= "Ora del giorno", y= "Minuti di ascolto") + 
  ggtitle("A che ora del giorno ho ascoltato più musica su Spotify?", "Attività da 0 a 23h")
```

Da questo grafico si può effettivamente vedere come la mia attività di ascolto sia spalmata in tutto il giorno (tranne di notte), soprattutto nel pomeriggio e tarda mattinata.


## Attività di riproduzione per orario del giorno e giorno della settimana

In quali giorni della settimana ho più attività di ascolto?

Ho risposto a questa domanda creando un'altra mappa di calore, visualizzando la relazione tra il giorno della settimana e l'ora del giorno.

```{r}

giorno = hoursDay %>% 
  group_by(weekday, hour) %>% 
  summarize(minutes = sum(minutesListened)) %>% 
  ggplot(aes(x = hour, weekday, fill = minutes)) + 
  geom_tile() + 
  scale_fill_gradient(low = "green", high = "blue") +
  labs(x= "Ora del giorno", y= "Giorno della settimana") + 
  ggtitle("In quale giorno della settimana e ora del giorno ho ascoltato più musica su Spotify?")

ggplotly(giorno)
```

Con questo grafico sono in grado di capire in quali giorni della settimana ho una maggiore attività: osservo chiaramente che in tutti i giorni ascolto abbastanza musica ma durante il sabato e la domenica ci sono dei picchi maggiori di ascolto (zone blu).


## Attività di riproduzione per orario del giorno e giorno della settimana - grafico a linee

Per avere più certezza della mia ipotesi creo un grafico a linee.

```{r}
weekDay <- hoursDay %>% 
  group_by(weekday, hour) %>% 
  summarize(minutes = sum(minutesListened)) %>% 
  ggplot(aes(x = hour, y = minutes, color = weekday)) + 
  geom_line() +
  labs(x= "Ora del giorno", y= "Minuti di ascolto") + 
  ggtitle("In quale giorno della settimana e ora del giorno ho ascoltato più musica?", "Line chart") 
weekDay
```

Posso notare che complessivamente sabato e domenica sono stati i giorni in cui ho ascoltato più musica. E' pazzesco come la linea tracciata sia simile per tutti i giorni della settimana!


NON PENSO DI METTERLO QUESTO!

## Attività di ascolto per tipo di giorno

Sebbene sia da ovviare dopo le visualizzazioni ottenute in precedenza, posso anche creare un altro grafico per vedere quale tipo di giorno (giorni feriali o fine settimana) ho avuto più attività.

```{r}
dayType <- hoursDay %>% 
  mutate(day_type = if_else(weekday %in% c("sab", "dom"), "weekend", "weekday")) %>% 
  group_by(day_type, hour) %>% 
  summarize(minutes = sum(minutesListened)) %>% 
  ggplot(aes(x = hour, y = minutes, color = day_type)) + 
  geom_line() +
  labs(x= "Ora del giorno", y= "Minuti di ascolto") + 
  ggtitle("Che tipo di giorno ho ascoltato più musica su Spotify?") 
ggplotly(dayType)
```

aggiungo canzoni
```{r aggiunta canzoni Lorde}
# aggiungo ultime canzoni di Lorde a mano
savedTracks = savedTracks %>%
  add_row(artist = "Lorde", album = "Pure Heroine", track = "Buzzcut Season", uri = "spotify:track:3ShTaJBCOclymogQNzPde7") %>%
  add_row(artist = "Lorde", album = "Pure Heroine", track = "Glory And Gore", uri = "spotify:track:0SK9wxN40P6jlcMfTSAe0V") %>%
  add_row(artist = "Lorde", album = "Pure Heroine", track = "Still Sane", uri = "spotify:track:0t1D6NQt3uhZnam0yg8Wv3") %>%
  add_row(artist = "Lorde", album = "Pure Heroine", track = "White Teeth Teens", uri = "spotify:track:15LzvCtoJWwsrTWJMWUTOv") %>%
  add_row(artist = "Lorde", album = "Pure Heroine", track = "A World Alone", uri = "spotify:track:2HLnzsXJ3mD9UWAa3RY89n") %>%
  add_row(artist = "Lorde", album = "Pure Heroine", track = "Bravado", uri = "spotify:track:02ZorlDGq0uTnMobHNh4EL") %>%
  add_row(artist = "Lorde", album = "Pure Heroine", track = "Million DOllar Bills", uri = "spotify:track:3Lw7lWTJlcqlx8E9HFmByr") %>%
  add_row(artist = "Lorde", album = "Pure Heroine", track = "The Love Club", uri = "spotify:track:2yrJ1jWo3HLksJFUqUsZE4") %>%
  add_row(artist = "Lorde", album = "Pure Heroine", track = "Biting Down", uri = "spotify:track:45UvXCltvMpEPNLGzG0NYk") %>%
  add_row(artist = "Lorde", album = "Pure Heroine", track = "Swingin Party", uri = "spotify:track:7otV7kSzDMo11qLlw8pAtr") %>%
  add_row(artist = "Lorde", album = "The Hunger Games: Mockingjay Pt.1 (Original Motion Picture Soundtrack)", track = "Meltdown", uri = "spotify:track:27qvbQ10N5uoqXvYT9MqZt") %>%
  add_row(artist = "Lorde", album = "Caracal (Deluxe)", track = "Magnets", uri = "spotify:track:7nRmfGNhHKEEu5o8yFXLXt") %>%
  add_row(artist = "Lorde", album = "MTV Unplugged", track = "Don't Take The Money", uri = "spotify:track:25wTebB8ECapFHWRPywpYR") %>%
  add_row(artist = "Lorde", album = "Alternate Worlds", track = "Easy", uri = "spotify:track:0rkqMaZsWZzfdz4brrhS14") %>%
  add_row(artist = "Lorde", album = "The Hunger Games: Mockingjay Pt.1 (Original Motion Picture Soundtrack)", track = "Yellow Flicker Beat", uri = "spotify:track:0HVINS0AfIuck7csStOEHP")
```


# Prova con le mie canzoni salvate!

## Top artisti basato sulle canzoni salvate

```{r top artisti}
topArtistFromSavedTracks = savedTracks %>%
  group_by(artist) %>%
  count(artist) %>%
  arrange(-n)


  
  # PLOT TOP 10 ARTISTS BASED ON LIKED TRACKS
plotMyFavs <- topArtistFromSavedTracks %>%
  filter(n >= 11) %>%
  mutate(freq = case_when(n > 100 ~ '> 100 brani',
      between(n, 50, 99) ~ '50-99 brani',
      between(n, 20, 49) ~ '20-49 brani',
      TRUE ~ '< 20 brani')) %>%
  mutate(freq = factor(freq, levels = c('> 100 brani', '50-99 brani', '20-49 brani', '< 20 brani'))) %>%
  ggplot(mapping = aes(x = reorder(artist, -n), y = n, fill = freq)) +
  geom_col() +
  #scale_fill_brewer(palette="Spectral") +
  labs(x= "Artista", y= "Numero di canzoni", fill = NULL) +
  ggtitle("Top artisti basato sulle canzoni salvate") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = -60),
        axis.title = element_text(face = 'bold'),
        plot.title = element_text(hjust = 0.5, face = 'bold', size = 15),
        plot.caption = element_text(hjust = 1,face = 'bold.italic'))
ggplotly(plotMyFavs)
#taylor complete collection: 267 brani
#lana comlete collection: 107 brani
```

taylor complete collection: 267 brani

lana comlete collection: 107 brani

## provo a capire quante volte ho ascoltato le canzoni su streamHistory2

```{r}
mostStreamedSongs = streamHistory2 %>%
  filter(msPlayed >= 50000) %>% #50 secondi
  group_by(trackName, artistName) %>%
  count(trackName) %>%
  arrange(-n) %>%
  filter(n >= 40)

mostStreamedArtist = mostStreamedSongs %>%
  group_by(artistName) %>%
  count(artistName) %>%
  arrange(-n)

#provo grafico, nei 2 assi n volte e titolo brano, colore artista
#n come colore?
#y frequenza e x top 50
#x artista, y numerosità

p <- mostStreamedSongs %>%
  ggplot(aes(x = reorder(trackName, -n), y = n, fill = artistName)) +
  geom_col() +
  theme(axis.text.x = element_blank())


ggplotly(p)
```

Le canzoni che ho ascoltato di più da aprile 2020 a luglio 2021 sono di Lana Del Rey, ce ne sono ben 12 (quella con più ascolti ne ha ben 143). Nel mezzo è presente anche un' altra canzone, una collaborazione tra Anne-Marie e Sam Fisher. Una canzone specifica di Taylor Swift, august, l'ho ascoltata per ben 100 volte! (ed è uscita l'anno scorso!)


# Spotify API e spotifyr

## trova le MIE ultime 5 canzoni ascoltate!

Con delle speciali API (Application Programming Interface) messe a disposizione da Spotify ed una libreria per R chiamata "spotifyr" si riescono ad avere molte altre informazioni riguardo al proprio account.

(La prima cosa che devi fare per poter iniziare a consumare tali dati tramite “spotifyr” è stabilire una connessione dalla tua applicazione in R. Per questo devi ottenere principalmente due parametri: SPOTIFY_CLIENT_ID e SPOTIFY_CLIENT_SECRET. Questi sono ottenuti dal portale Spotify per sviluppatori, creando una nuova applicazione su https://developer.spotify.com/dashboard/applications dove ti verrà chiesto di accedere con le stesse credenziali del tuo account Spotify.)

Un esempio molto semplice, le mie ultime 5 canzoni riprodotte!
```{r}
get_my_recently_played(limit = 5) %>% 
    mutate(artist.name = map_chr(track.artists, function(x) x$name[1]),
           played_at = as_datetime(played_at)) %>% 
    select(track.name, artist.name, track.album.name, played_at) %>% 
    kable() #funzione di knitr per creare tabelle

```

## artisti più ascoltati long term

```{r}
genereLong50 = get_my_top_artists_or_tracks(type = 'artists', time_range = 'long_term', limit = 50) %>%
    select(name, genres, popularity, followers.total) %>% 
    rowwise %>% 
    mutate(genres = paste(genres, collapse = ', ')) %>% 
    ungroup
#tolgo cose inutili
#write.csv(genereLong50,"genereLong50_2.csv", row.names = FALSE)
#riprendo dataframe
genereLong50Mod <- read.csv("genereLongg.csv")

top50 <- genereLong50Mod %>%
  ggplot(aes(x = popularity, y = followers.total, colour = name, genres = genres)) +
  geom_point()


ggplotly(top50, tooltip = c("x", "y", "colour", "genres"))
```


## artisti più ascoltati short term + modifiche + grafico GENERI

```{r}
# trova i MIEI artisti più ascoltati ultimamente
#genereShort = get_my_top_artists_or_tracks(type = 'artists', time_range = 'short_term') %>%
#    select(name, genres, popularity, followers.total) %>% 
#    rowwise %>% 
#    mutate(genres = paste(genres, collapse = ', ')) %>% 
#    ungroup


#mi copio la tabella perhcè viene modificata!
#write.csv(genereShort,"genereShort.csv", row.names = FALSE)

genereShort <- read.csv("genereShort.csv")

# GRAFICO GENERI TOP ARTISTI!!!
#modifico la tabella
genereShort$pop = 0              #5
genereShort$postTeen.pop = 0     #6
genereShort$art.pop = 0          #7
genereShort$dance.pop = 0        #8
genereShort$electropop = 0       #9
genereShort$indie.pop = 0        #10
genereShort$uk.pop = 0           #11
genereShort$modern.rock = 0      #12
genereShort$pop.rock = 0         #13
genereShort$pop.rap = 0          #14
genereShort$RandB = 0            #15
genereShort$punk = 0             #16

# assegno ad ogni artista il genere esatto
#Tay
genereShort[1,5] = 1
genereShort[1,6] = 1
#Lorde
genereShort[2,7] = 1
genereShort[2,8] = 1
genereShort[2,9] = 1
genereShort[2,5] = 1
genereShort[2,6] = 1
#Sasha Sloan
genereShort[3,9] = 1
genereShort[3,10] = 1
genereShort[3,5] = 1
genereShort[3,6] = 1
#OLIVIA
genereShort[4,5] = 1
#TOVE LO
genereShort[5,8] = 1
genereShort[5,9] = 1
genereShort[5,5] = 1
genereShort[5,6] = 1
genereShort[5,14] = 1
#LANA
genereShort[6,7] = 1
genereShort[6,5] = 1
#ANNE MARIE
genereShort[7,8] = 1
genereShort[7,5] = 1
genereShort[7,6] = 1
genereShort[7,11] = 1
#CHASE ATLANTIC
genereShort[8,12] = 1
genereShort[8,5] = 1
#AVRIL
genereShort[9,5] = 1
genereShort[9,6] = 1
genereShort[9,8] = 1
#HAIM
genereShort[10,7] = 1
genereShort[10,8] = 1
genereShort[10,10] = 1
genereShort[10,13] = 1
#BILLIE
genereShort[11,9] = 1
genereShort[11,5] = 1
#Demi Lovato
genereShort[12,5] = 1
genereShort[12,6] = 1
genereShort[12,8] = 1
#Dua Lipa
genereShort[13,8] = 1
genereShort[13,5] = 1
genereShort[13,11] = 1
#Sleeping At Last
genereShort[14,5] = 1
genereShort[14,10] = 1
genereShort[14,13] = 1
#FLETCHER
genereShort[15,8] = 1
genereShort[15,9] = 1
genereShort[15,5] = 1
genereShort[15,6] = 1
genereShort[15,10] = 1
#THE WEEKND
genereShort[16,5] = 1
genereShort[16,15] = 1
#Halsey
genereShort[17,8] = 1
genereShort[17,9] = 1
genereShort[17,5] = 1
genereShort[17,6] = 1
genereShort[17,10] = 1
#Rita Ora
genereShort[18,8] = 1
genereShort[18,9] = 1
genereShort[18,14] = 1
genereShort[18,6] = 1
genereShort[18,11] = 1
#BLINK 182
genereShort[19,16] = 1
#KHALID
genereShort[20,5] = 1


#creo un nuovo dataframe per fare un grafico sui generi più ascoltati recentemente
nome <- c("pop", "post-teen pop", "art pop", "dance pop", "electropop", "indie pop", "uk pop", "modern rock", "pop rock", "pop rap", "r&b", "punk")
tot <- c(17, 10, 3, 10, 7, 5, 3, 1, 2, 2, 1, 1)

gen <- data.frame(nome, tot)

grafGen <- gen %>%
  ggplot(aes(x = nome, y = tot)) +
  ggtitle("Generi più riprodotti ultimamente") +
  #theme_dark() +
  geom_col(aes(fill = nome)) +
  labs(x = "genere", y = "totale per genere") +
  theme(axis.text.x = element_text(angle = 90), plot.title = element_text(face = "italic"))
#plot.background = element_rect(fill = "green")



ggplotly(grafGen)

#netta maggioranza per il pop ma è presente anche rock e punk!

```


Sono presenti molte sfumature del pop, il quale è palesemente il mio genere più ascoltato ultimanente. A seguire rock e punk.

# playlist july
```{r}
# GET SPECIFIC PLAYLIST FEATURES
playlist_username <- 'VII/MMXXI july'
playlist_uris <- c('5jWdr5QCwbEi7mxO7cTAGh')
playlistJuly <- get_playlist_audio_features(playlist_username, playlist_uris)
```

```{r}
# PLOT LESS POPULARITY TRACKS ON SPECIFIC PLAYLIST
playlistJuly %>%
  group_by(track.album.name) %>% 
  ggplot(aes(x = track.album.name, y = valence)) + 
  geom_col(aes(fill = track.album.name)) +
  labs(x= "Track name", y= "Valence") + 
  ggtitle("What are the least popular songs I listen to on Spotify?", "Popularity ranking < 50 in a specific playlist") +
  theme(axis.text.x = element_text(angle = 90))

playlistJuly %>% 
  group_by(track.album.name) %>% 
  summarise(mean(valence)) %>% 
  arrange(desc(`mean(valence)`)) %>% 
  kable() %>% 
  kable_styling(full_width = F, position = "left")

```


# tolgo dati inutili dal df e aggiungo nome artista
```{r}
playlistJuly_2 = playlistJuly %>%
  select(track.name, track.artists, track.album.name, danceability, energy, key, loudness, speechiness, acousticness, instrumentalness, liveness, valence, tempo, track.popularity, track.album.name, track.album.release_date) %>%
  mutate(track.artists = map_chr(track.artists, function(x) x$name[1]))
```


```{r}
p = ggplot(data = playlistJuly_2, aes(x = valence, y = energy, color = track.artists)) +
  geom_jitter(aes(text = track.name)) +
  geom_vline(xintercept = 0.5) +
  geom_hline(yintercept = 0.5) +
  scale_x_continuous(expand = c(0, 0), limits = c(0, 1)) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 1)) +
  annotate('text', 0.25 / 2, 0.95, label = "Turbulent/Angry", fontface =
             "bold") +
  annotate('text', 1.75 / 2, 0.95, label = "Happy/Joyful", fontface = "bold") +
  annotate('text', 1.75 / 2, 0.05, label = "Chill/Peaceful", fontface =
             "bold") +
  annotate('text', 0.25 / 2, 0.05, label = "Sad/Depressing", fontface =
             "bold")

ggplotly(p)
```



# cosa finale guida bella explore your activity bla bla
```{r}
# GET FEATURES TOP FIVE FAVORITE ARTISTS
favArtist1 <- get_artist_audio_features(artist= "Taylor Swift")
favArtist2 <- get_artist_audio_features(artist= "Lana Del Rey")
favArtist3 <- get_artist_audio_features(artist= "Demi Lovato")
favArtist4 <- get_artist_audio_features(artist= "Avril Lavigne")
favArtist5 <- get_artist_audio_features(artist= "Lorde")

#CAMBIARE E TOGLIERE GLI ALBUM INUTILI!!! TENERE SOLO QUELLI IMPORTANTI
#prendo solo gli album utili per tay
favArtist1 <- favArtist1[which(favArtist1$album_name %in% c("1989 (Deluxe)","evermore (deluxe version)", "Fearless (Platinum Edition)", "Fearless (Taylor's Version)", "folklore (deluxe version)", "Lover", "Red (Deluxe Edition)", "reputation", "Speak Now (Deluxe Package)", "Taylor Swift")),]

#prendo le canzoni uniche, non ripetute
favArtist1 <- favArtist1 %>%
  distinct(track_name, .keep_all = TRUE)

#prendo solo gli album utili per lana
favArtist2 <- favArtist2[which(favArtist2$album_name %in% c("Born To Die – Paradise Edition (Special Version)", "Chemtrails Over The Country Club", "Honeymoon", "Lust For Life", "Norman Fucking Rockwell!", "Ultraviolence (Deluxe)")),]

#prendo le canzoni uniche, non ripetute
favArtist2 <- favArtist2 %>%
  distinct(track_name, .keep_all = TRUE) # per tenere anche le altre colonne, di default tiene solo track_name

#prendo solo gli album utili per demi
favArtist3 <- favArtist3[which(favArtist3$album_name %in% c("Confident (Deluxe Edition)", "Dancing With The Devil…The Art of Starting Over (Expanded Edition)", "Demi (Deluxe)", "Don't Forget", "Here We Go Again (European Version)", "Tell Me You Love Me (Deluxe)", "Unbroken (Deluxe Edition)")),]

#prendo le canzoni uniche, non ripetute
favArtist3 <- favArtist3 %>%
  distinct(track_name, .keep_all = TRUE)

#avril è okay

#prendo solo gli album utili per lorde
favArtist5 <- favArtist5[which(favArtist5$album_name %in% c("Melodrama", "Pure Heroine (Extended)")),]

#prendo le canzoni uniche, non ripetute
favArtist5 <- favArtist5 %>%
  distinct(track_name, .keep_all = TRUE)

# MAKE A SINGLE DATA FRAME
topFiveArtists <- rbind(favArtist1, favArtist2, favArtist3, favArtist4, favArtist5)
# PLOT EMOTIONAL QUADRANT TOP FOUR ARTISTS
emotionalQuadrant <- ggplot(data = topFiveArtists, aes(x = valence, y = energy, color = artist_name)) +
  geom_jitter(aes(text = track_name)) +
  geom_vline(xintercept = 0.5) +
  geom_hline(yintercept = 0.5) +
  scale_x_continuous(expand = c(0, 0), limits = c(0, 1)) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 1)) +
  annotate('text', 0.25 / 2, 0.95, label = "Angry / Turbulent") +
  annotate('text', 1.75 / 2, 0.95, label = "Joyful / Happy") +
  annotate('text', 1.75 / 2, 0.05, label = "Peace / Chill") +
  annotate('text', 0.25 / 2, 0.05, label = "Depressing / Sad") +
  labs(x= "Valence", y= "Energy") +
  ggtitle("Emotional quadrant Top five artists", "Based on energy y valence")  
ggplotly(emotionalQuadrant)
```


